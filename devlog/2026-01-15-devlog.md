# 2026-01-15 開發日誌

## 1. 開發規劃 (Planning)
- [x] 修復後端 502 Bad Gateway 啟動錯誤 (Fix Backend Startup Failure)
- [x] 修復資料庫遷移導致的員工編號衝突 (Fix Database Migration & ID Conflict)
- [x] 優化員工建立流程，採用兩段式建立確保 ID 唯一 (Improve User Creation Flow)
- [x] 實作自動補全缺失員工編號的邏輯 (Implement Auto-Backfill for Missing IDs)

## 2. 專案結構 (Project Structure)
```
ERP/
├── backend/                # NestJS 後端
├── chat-service/           # Go 聊天服務
├── devlog/                 # 開發日誌
├── docker/                 # Docker 配置
│   └── prod/               # 生產環境配置
├── frontend/               # React 前端
└── 需求/                   # 需求文檔
```

## 3. 進度 (Progress)
- **Backend**:
  - 修正 `prisma/schema.prisma` 將 `empId` 設為選填以支援遷移。
  - 重構 `UsersService.create` 改為先建立 User 再更新 `empId`，徹底解決 `EMP101` 衝突問題。
  - 在 `onModuleInit` 加入自動檢查與補全 `empId` 的邏輯。
  - 修正 API 錯誤回傳，將重複錯誤改為 `409 Conflict`。
- **Deployment**:
  - 更新 Docker 啟動腳本，確保 Migration 自動執行。

## 4. Git 提交記錄
- `28687dc` - fix(backend): apply proper two-step user creation and id backfill
- `c837ca4` - fix(backend): return 409 Conflict for duplicates instead of 401
- `1620f9d` - fix(backend): fix user creation error 500 by handling unique constraints
- `7055285` - fix(backend): improve user creation error handling and backfill empId
- `21d53ce` - fix(backend): make empId optional to allow migration and backfill missing IDs
